<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>
<title>Renew | Branding Inteligente</title>
<style>
:root{
  --bg1:#0f2f2f;--bg2:#1a1a1a;--accent:#2e8b57;--soft:#143c3c;--text:#e0f2f1;--muted:#aef1d2;
}
*{box-sizing:border-box;}
body{margin:0;font-family:Segoe UI,system-ui,-apple-system,sans-serif;background:linear-gradient(135deg,var(--bg1),var(--bg2));color:var(--text);scroll-behavior:smooth;}
nav{display:flex;justify-content:space-between;align-items:center;background:var(--soft);padding:1rem 2rem;position:sticky;top:0;z-index:100;}
nav .brand{color:var(--muted);font-weight:700;font-size:1.5rem;}
nav a{color:var(--text);text-decoration:none;font-weight:600;margin-left:1rem;cursor:pointer;}
nav a:hover{color:var(--muted);}
.page{display:none;padding:2rem;}
.active{display:block;}
header{text-align:center;padding:4rem 2rem;background:var(--soft);border-bottom-left-radius:30px;border-bottom-right-radius:30px;}
header h1{margin:0;font-size:3rem;background: linear-gradient(90deg, #2e8b57, #aef1d2); -webkit-background-clip: text; -webkit-text-fill-color: transparent;}
header p{max-width:900px;margin:1rem auto 0;font-size:1.2rem;line-height:1.6;color:var(--muted);}
.cta-btn{display:inline-block;margin-top:2rem;padding:0.8rem 1.5rem;border-radius:8px;background:#2e8b57;color:white;font-weight:600;text-decoration:none;transition:0.3s all;}
.cta-btn:hover{background:#1f6450;transform:translateY(-3px);}
.grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:1.5rem;margin-top:2rem;}
.card{background:#1e2e2e;border-radius:12px;padding:1.25rem;box-shadow:0 0 12px rgba(0,255,200,.08);transition:0.3s all;opacity:1;}
.card h3{margin-top:0;}
.card p{color:#cceee8;}
.card:hover{transform:translateY(-5px);box-shadow:0 8px 20px rgba(0,255,200,0.2);}
.chatbox{background:#1e2e2e;border-radius:14px;padding:1rem;max-width:500px;margin:2rem auto;box-shadow:0 0 12px rgba(0,255,200,.08);}
.chatlog{height:300px;overflow-y:auto;background:#0f1f1f;padding:1rem;border-radius:10px;margin-bottom:1rem;color:#cceee8;white-space:pre-line;}
.msg{margin:.4rem 0;}
.msg strong{color:#aef1d2;}
.inputrow{display:flex;gap:.5rem;}
input{flex:1;padding:.5rem;border:none;border-radius:5px;background:#143c3c;color:#e0f2f1;}
button{padding:.5rem 1rem;background:#2e8b57;color:white;border:none;border-radius:5px;cursor:pointer;}
.quick{display:flex;flex-wrap:wrap;gap:.5rem;margin-top:.6rem;}
.quick button{background:#1f4f4f;}
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,.7);align-items:center;justify-content:center;z-index:1000;}
.modal-content{background:#1e2e2e;padding:1rem;border-radius:12px;max-width:600px;width:90%;max-height:80%;overflow:auto;box-shadow:0 0 15px rgba(0,255,200,.2);}
.modal h3{margin-top:0;color:var(--muted);}
.calendar{display:grid;grid-template-columns:repeat(7,1fr);gap:.3rem;margin-top:.5rem;font-size:0.85rem;}
.day{background:#143c3c;padding:.4rem;border-radius:4px;text-align:center;cursor:pointer;}
.day.has-event{background:#2e8b57;color:white;font-weight:bold;}
.close{float:right;cursor:pointer;color:var(--muted);}
.menu-item{border-bottom:1px solid #2e8b57;padding:.5rem 0;}
.menu-item span{float:right;color:var(--accent);}
.month-container{margin-top:1rem;}
.month-title{text-align:center;font-weight:600;color:var(--muted);margin-bottom:.3rem;}
.small{font-size:0.9rem;color:#bdeedc;}
</style>
</head>
<body>

<nav>
  <div class="brand">Renew</div>
  <div>
    <a onclick="showPage('inicio')">Inicio</a>
    <a onclick="showPage('chatbot')">Demo de Chatbot</a>
  </div>
</nav>

<div id="inicio" class="page active">
  <header>
    <h1>Branding inteligente</h1>
    <p>Ayudamos a negocios a crear su identidad visual y verbal combinando creatividad e inteligencia artificial para un branding √∫nico y memorable.</p>
    <a href="#" onclick="showPage('chatbot')" class="cta-btn">Probar Chatbots</a>
  </header>
  <section style="background:#143c3c;border-radius:20px;padding:2rem;margin-top:2rem;">
    <h2 style="text-align:center;">Qu√© hacemos</h2>
    <div class="grid">
      <div class="card"><h3>üé® Identidad visual</h3><p>Creaci√≥n de logos, paletas y sistemas gr√°ficos consistentes que definen la imagen de tu negocio.</p></div>
      <div class="card"><h3>‚úçÔ∏è Identidad verbal</h3><p>Dise√±o de tono y mensajes que transmiten la personalidad de tu marca con claridad y coherencia.</p></div>
      <div class="card"><h3>üìà Estrategia de marca</h3><p>Posicionamiento estrat√©gico y experiencias alineadas al negocio para generar confianza y recordaci√≥n.</p></div>
      <div class="card"><h3>ü§ñ Branding con IA</h3><p>Integraci√≥n de inteligencia artificial para crear contenidos y experiencias innovadoras que conectan con tus clientes.</p></div>
    </div>
  </section>
</div>

<div id="chatbot" class="page">
<h2>üëæ Demo interactiva: Aura</h2>
<div class="chatbox">
  <div id="chatlog" class="chatlog"><div class="msg"><strong>Aura:</strong> ¬°Hola! Soy Aura üòé. Dime algo como ‚Äúquiero una cita el 10 de octubre a las 5 pm para Ana‚Äù.</div></div>
  <div class="inputrow">
    <input id="userInput" type="text" placeholder="Escribe tu mensaje..."/>
    <button onclick="sendMessage('aura')">Enviar</button>
  </div>
  <div class="quick">
    <button onclick="quick('Quiero agendar una cita','aura')">Agendar</button>
    <button onclick="quick('Ver mis citas','aura')">Mis citas</button>
    <button onclick="quick('Cancelar mi √∫ltima cita','aura')">Cancelar cita</button>
    <button onclick="openCalendar('aura')">Calendario</button>
  </div>
</div>

<h2>üçΩÔ∏è Demo interactiva: Paco</h2>
<div class="chatbox">
  <div id="chatlog2" class="chatlog"><div class="msg"><strong>Paco:</strong> ¬°Hola, amigo! Soy Paco üòÑ. Dime algo como ‚Äúquiero reservar para ma√±ana a las 8 para Juan‚Äù.</div></div>
  <div class="inputrow">
    <input id="userInput2" type="text" placeholder="Escribe tu mensaje..."/>
    <button onclick="sendMessage('paco')">Enviar</button>
  </div>
  <div class="quick">
    <button onclick="quick('Reservar mesa','paco')">Reservar</button>
    <button onclick="quick('Ver mis reservas','paco')">Mis reservas</button>
    <button onclick="quick('Cancelar mi reserva','paco')">Cancelar</button>
    <button onclick="openCalendar('paco')">Calendario</button>
    <button onclick="openMenu()">Carta</button>
  </div>
</div>
</div>

<div id="calendarModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeCalendar()">‚úñ</span>
    <h3>üìÖ Calendario de reservas</h3>
    <div id="calendarContainer"></div>
  </div>
</div>

<div id="menuModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeMenu()">‚úñ</span>
    <h3>üç¥ Carta de Paco</h3>
    <div id="menuContainer"></div>
  </div>
</div>

<script>
/* -------------------------
   Datos y UI b√°sicos (sin tocar)
   ------------------------- */
let citas=[], reservas=[], menu=[
  {plato:"Paella Valenciana",precio:"12‚Ç¨",alergenos:"Marisco, Gluten"},
  {plato:"Ensalada C√©sar",precio:"8‚Ç¨",alergenos:"L√°cteos, Huevo"},
  {plato:"Sopa de verduras",precio:"6‚Ç¨",alergenos:"Ninguno"},
  {plato:"Pizza Margarita",precio:"10‚Ç¨",alergenos:"Gluten, L√°cteos"}
];

function showPage(id){document.querySelectorAll('.page').forEach(p=>p.classList.remove('active'));document.getElementById(id).classList.add('active');}
function append(sender,text,log){const d=document.createElement('div');d.className='msg';d.innerHTML=`<strong>${sender}:</strong> ${text}`;log.appendChild(d);log.scrollTop=log.scrollHeight;}
function sendMessage(bot){const input=document.getElementById(bot==='aura'?'userInput':'userInput2');const log=document.getElementById(bot==='aura'?'chatlog':'chatlog2');const msg=input.value.trim();if(!msg)return;append('T√∫',msg,log);input.value='';if(bot==='aura'){setTimeout(()=>replyAura(msg),200);}else{setTimeout(()=>replyPaco(msg),200);}}
function quick(text,bot){const input=document.getElementById(bot==='aura'?'userInput':'userInput2');input.value=text;sendMessage(bot);}
document.getElementById('userInput').addEventListener('keydown',e=>{if(e.key==='Enter'){e.preventDefault();sendMessage('aura');}});
document.getElementById('userInput2').addEventListener('keydown',e=>{if(e.key==='Enter'){e.preventDefault();sendMessage('paco');}});

/* -------------------------
   Utilidades de NLP ligero
   - normalize: quita acentos, puntuaci√≥n, lower
   - levenshtein + similarity
   - intent matcher con umbral
   ------------------------- */

function normalize(text){
  if(!text) return "";
  // pasar a min√∫sculas, quitar tildes y caracteres raros, mantener letras y n√∫meros y espacios
  const accentMap = {'√°':'a','√©':'e','√≠':'i','√≥':'o','√∫':'u','√º':'u','√Å':'a','√â':'e','√ç':'i','√ì':'o','√ö':'u','√ú':'u','√±':'n','√ë':'n'};
  text = text.replace(/[^\w\s:\/\.,\-√°√©√≠√≥√∫√º√Å√â√ç√ì√ö√ú√±√ë]/g,' ');
  text = text.split('').map(c=>accentMap[c]||c).join('');
  text = text.toLowerCase();
  // normalizar espacios
  return text.replace(/\s+/g,' ').trim();
}

// Levenshtein distance (iterativa, eficiente)
function levenshtein(a,b){
  a = String(a); b = String(b);
  if(a === b) return 0;
  const al = a.length, bl = b.length;
  if(al === 0) return bl;
  if(bl === 0) return al;
  let v0 = new Array(bl+1), v1 = new Array(bl+1);
  for(let j=0;j<=bl;j++) v0[j]=j;
  for(let i=0;i<al;i++){
    v1[0]=i+1;
    for(let j=0;j<bl;j++){
      const cost = a[i] === b[j] ? 0 : 1;
      v1[j+1] = Math.min(v1[j]+1, v0[j+1]+1, v0[j]+cost);
    }
    [v0,v1]=[v1,v0];
  }
  return v0[bl];
}

function similarity(a,b){
  a = normalize(a); b = normalize(b);
  if(!a && !b) return 1;
  if(!a || !b) return 0;
  const dist = levenshtein(a,b);
  const maxLen = Math.max(a.length, b.length);
  return 1 - (dist / maxLen);
}

// token overlap score: qu√© porcentaje de tokens de pattern aparecen en msg (tolerante)
function tokenOverlapScore(msg, pattern){
  const mTokens = normalize(msg).split(' ').filter(Boolean);
  const pTokens = normalize(pattern).split(' ').filter(Boolean);
  if(pTokens.length===0) return 0;
  let matched = 0;
  for(const pt of pTokens){
    for(const mt of mTokens){
      // si son exactamente iguales o parecidas (similarity > 0.7)
      if(pt===mt || similarity(pt, mt) > 0.65){ matched++; break; }
    }
  }
  return matched / pTokens.length;
}

/* -------------------------
   Intenciones definidas (ejemplos)
   El sistema compara lo escrito con TODOS los ejemplos y elige la intenci√≥n con mejor puntuaci√≥n.
   ------------------------- */
const INTENTS = [
  { name: 'saludo', examples: ['hola','buenas','buenos dias','buenas tardes','holaa','holi'] },
  { name: 'agendar', examples: ['quiero agendar una cita','agendar cita','tengo que ir','reservar cita','quiero cita','agendar'] },
  { name: 'reservar', examples: ['reservar mesa','hacer reserva','quiero reservar','reservacion','reservar para 2','reserbar','reserva'] },
  { name: 'ver_citas', examples: ['ver mis citas','mis citas','mostrar citas','tengo cita','citas pendientes','mis horas'] },
  { name: 'ver_reservas', examples: ['ver mis reservas','mis reservas','mostrar reservas','reservas pendientes'] },
  { name: 'cancelar_cita', examples: ['cancelar cita','anular cita','no puedo ir','cancelar mi cita','cancelar la cita'] },
  { name: 'cancelar_reserva', examples: ['cancelar reserva','anular reserva','no puedo ir a la reserva','cancelar mi reserva'] },
  { name: 'menu', examples: ['menu','carta','ver menu','que hay','que ofrecen','platos','ver comida','carta de hoy'] },
  { name: 'horario', examples: ['horario','a que hora abren','a que hora cierran','horario de apertura','cuando abren'] },
  { name: 'gracias', examples: ['gracias','muchas gracias','gracais','thx','thanks','ok gracias','perfecto'] },
  { name: 'despedida', examples: ['adios','hasta luego','nos vemos','chao'] },
];

/* matchIntent: devuelve {intent,score} mejor */
function matchIntent(msg){
  msg = normalize(msg);
  let best = {intent: null, score: 0, sample: null};
  for(const intent of INTENTS){
    for(const sample of intent.examples){
      const sim = Math.max(similarity(msg, sample), tokenOverlapScore(msg, sample));
      // boost si msg contiene palabra clave exacta
      const key = sample.split(' ')[0];
      if(key && new RegExp('\\b'+key+'\\b').test(msg)) {
        // ligero boost para prioridades
        const boosted = Math.min(1, sim + 0.12);
        if(boosted > best.score){ best = {intent: intent.name, score: boosted, sample}; }
      } else {
        if(sim > best.score){ best = {intent: intent.name, score: sim, sample}; }
      }
    }
  }
  return best;
}

/* -------------------------
   Parsers simples para extraer nombre/hora/fecha
   - detecta fechas tipo "10/10/2025", "10 oct", "ma√±ana", "hoy"
   - detecta horas "5 pm", "17:30", "8", "a las 8"
   - detecta "para NOMBRE" y "para 2 personas"
   ------------------------- */

function parseDateFromText(text){
  const n = normalize(text);
  // hoy / ma√±ana / pasado
  if(/\b(hoy)\b/.test(n)) return formatDate(new Date());
  if(/\b(ma√±ana|manana)\b/.test(n)) return formatDate(new Date(Date.now()+24*3600*1000));
  // dd/mm/yyyy or dd/mm
  let m = n.match(/\b([0-3]?\d)[\/\-]([0-1]?\d)([\/\-](\d{2,4}))?\b/);
  if(m){
    const day = parseInt(m[1],10), month = parseInt(m[2],10);
    let year = m[4]? parseInt(m[4],10): (new Date()).getFullYear();
    if(year < 100) year += 2000;
    return `${day}/${month}/${year}`;
  }
  // "10 octubre", "10 oct", with month names (es)
  const months = {enero:1,febrero:2,marzo:3,abril:4,mayo:5,junio:6,julio:7,agosto:8,septiembre:9,octubre:10,noviembre:11,diciembre:12,ene:1,feb:2,mar:3,abr:4,may:5,jun:6,jul:7,ago:8,sep:9,oct:10,nov:11,dic:12};
  m = n.match(/\b([0-3]?\d)\s+(enero|febrero|marzo|abril|mayo|junio|julio|agosto|septiembre|octubre|noviembre|diciembre|ene|feb|mar|abr|may|jun|jul|ago|sep|oct|nov|dic)\b/);
  if(m){
    const day = parseInt(m[1],10), month = months[m[2]]; const year = (new Date()).getFullYear();
    return `${day}/${month}/${year}`;
  }
  return ""; // no detectada
}

function formatDate(d){
  const day = d.getDate(), month = d.getMonth()+1, year = d.getFullYear();
  return `${day}/${month}/${year}`;
}

function parseTimeFromText(text){
  const n = normalize(text);
  // hh:mm
  let m = n.match(/\b([0-1]?\d|2[0-3]):([0-5]\d)\b/);
  if(m) return `${m[1]}:${m[2]}`;
  // h am/pm
  m = n.match(/\b([0-1]?\d|2[0-3])\s*(am|pm)\b/);
  if(m) return `${m[1]} ${m[2]}`;
  // "a las 8", "8h", "a las 20"
  m = n.match(/\b(a las\s*)?([0-2]?\d)(\s?h)?\b/);
  if(m){
    // avoid matching general numbers like "para 2 personas" as time: check context
    // if text contains palabra "persona" o "personas", probably it's party size
    if(/\bpersonas?\b/.test(n) || /\bpara\s+[0-9]+\b/.test(n)) return "";
    return `${m[2]}:00`;
  }
  return "";
}

function parseNameFromText(text){
  const n = text;
  const m = n.match(/\bpara\s+([A-Z√Å√â√ç√ì√ö√ú√ë][a-z√°√©√≠√≥√∫√º√±A-Z√Å√â√ç√ì√ö√ú√ë\-]+)\b/i);
  if(m) return m[1];
  // tambi√©n "para juan", "para mar√≠a"
  const m2 = n.match(/\bpara\s+([a-z√°√©√≠√≥√∫√º√±]+)\b/i);
  if(m2) return capitalize(m2[1]);
  return ""; // no detectado
}
function capitalize(s){ if(!s) return s; return s.charAt(0).toUpperCase()+s.slice(1); }

/* -------------------------
   Umbrales y ayuda para respuestas
   - si score > 0.55 consideramos intenci√≥n bastante segura
   - si 0.38-0.55, utilizamos sugerencia / confirmaci√≥n
   ------------------------- */
const CONFIDENT_THRESHOLD = 0.55;
const SUGGEST_THRESHOLD = 0.38;

/* -------------------------
   Respuestas inteligentes para AURA (peluquer√≠a / citas)
   ------------------------- */
function replyAura(rawMsg){
  const log = document.getElementById('chatlog');
  const msg = String(rawMsg).trim();
  const norm = normalize(msg);

  // intentar extraer intent r√°pidamente si hay palabras claves
  const match = matchIntent(msg);

  // extraer datos
  const fecha = parseDateFromText(msg);
  const hora = parseTimeFromText(msg);
  const nombre = parseNameFromText(msg) || "Cliente";

  // manejar intents con umbral
  if(match.score >= CONFIDENT_THRESHOLD){
    switch(match.intent){
      case 'saludo':
        append('Aura','¬°Hola! üòÑ ¬øQuieres agendar una cita, ver tus citas o cancelar alguna?',log); return;
      case 'agendar':
        if(fecha){
          const info = hora ? `${nombre} a las ${hora}` : nombre;
          citas.push(`${info} ‚Äî ${fecha}`);
          append('Aura',`‚úÖ Cita registrada para ${info} el ${fecha}`,log);
        } else {
          append('Aura','Perfecto, dime para qu√© d√≠a quieres la cita (puedes escribir "hoy", "ma√±ana" o un d√≠a como "10 oct") o usa el calendario.',log);
          openCalendar('aura');
        }
        return;
      case 'ver_citas':
        if(citas.length===0){ append('Aura','No tienes citas üòÖ',log); return; }
        append('Aura','Tus citas:\n'+citas.join('\n'),log); return;
      case 'cancelar_cita':
        if(citas.length===0){ append('Aura','No hay citas que cancelar üòÖ',log); return; }
        // permitir cancelar por fecha si detectada
        if(fecha){
          // buscar cita con esa fecha
          const idx = citas.findIndex(c => c.includes(fecha));
          if(idx >= 0){
            const removed = citas.splice(idx,1)[0];
            append('Aura',`He cancelado la cita: ${removed}`,log); return;
          }
        }
        const r = citas.pop(); append('Aura',`He cancelado tu √∫ltima cita: ${r}`,log); return;
      case 'horario':
        append('Aura','Nuestro horario es de 9:00 a 19:00, de lunes a s√°bado. ¬øQuieres reservar dentro de ese horario?',log); return;
      case 'gracias':
        append('Aura','¬°De nada! üòä ¬øTe ayudo a agendar algo m√°s?',log); return;
      case 'despedida':
        append('Aura','¬°Hasta pronto! Si necesitas otra cita, aqu√≠ estoy üòâ',log); return;
      default:
        break;
    }
  }

  // si no est√° claro, revisar sugerencias con puntuaci√≥n moderada
  if(match.score >= SUGGEST_THRESHOLD){
    const intent = match.intent;
    // sugerir acci√≥n
    if(intent === 'agendar'){
      append('Aura',`Creo que quieres *agendar* (interpreto: "${match.sample}"). ¬øQuieres abrir el calendario para elegir d√≠a/hora?`,log);
      openCalendar('aura');
      return;
    }
    if(intent === 'ver_citas'){
      if(citas.length===0){ append('Aura','Creo que quieres ver tus citas, pero no tienes ninguna üòÖ',log); return; }
      append('Aura','Creo que quieres ver tus citas:\n'+citas.join('\n'),log); return;
    }
    if(intent === 'cancelar_cita'){
      if(citas.length===0){ append('Aura','No hay citas que cancelar üòÖ',log); return; }
      append('Aura','¬øQuieres que cancele tu √∫ltima cita? (Escribe "s√≠" para confirmar)',log); return;
    }
    if(intent === 'horario'){
      append('Aura','Nuestro horario es de 9:00 a 19:00, de lunes a s√°bado.',log); return;
    }
  }

  // Reglas especiales: si detecta n√∫mero de tel√©fono (simple) o "quiero cita 10/10 5pm para ana"
  if(/\b\d{1,2}[\/\-]\d{1,2}([\/\-]\d{2,4})?\b/.test(msg) || /\b(hoy|ma√±ana|manana)\b/.test(norm) || /(\b(a las|am|pm|:)\b)/.test(norm)){
    // si hay fecha detectada, pedir confirmaci√≥n o crear
    if(fecha){
      const info = hora ? `${nombre} a las ${hora}` : nombre;
      citas.push(`${info} ‚Äî ${fecha}`);
      append('Aura',`‚úÖ Cita registrada para ${info} el ${fecha}`,log);
      return;
    } else {
      append('Aura','Veo una referencia temporal, ¬øpuedes confirmar fecha y hora? (ej: "10 oct 17:00 para Ana")',log); return;
    }
  }

  // fallback: preguntar con opciones
  append('Aura','Lo siento, no estoy segura de entender. Puedes decir (por ejemplo):\n- "Quiero una cita el 10/10 a las 17 para Ana"\n- "Ver mis citas"\n- "Cancelar cita"\nTambi√©n puedo abrir el calendario si quieres.',log);
}

/* -------------------------
   Respuestas inteligentes para PACO (restaurante)
   ------------------------- */
function replyPaco(rawMsg){
  const log = document.getElementById('chatlog2');
  const msg = String(rawMsg).trim();
  const norm = normalize(msg);

  const match = matchIntent(msg);
  const fecha = parseDateFromText(msg);
  const hora = parseTimeFromText(msg);
  const nombre = parseNameFromText(msg) || "Cliente";

  if(match.score >= CONFIDENT_THRESHOLD){
    switch(match.intent){
      case 'saludo':
        append('Paco','¬°Hola! üòÑ ¬øQuieres reservar, ver el men√∫ o tus reservas?',log); return;
      case 'reservar':
        if(fecha){
          // buscar n√∫mero de personas
          const peopleMatch = normalize(msg).match(/\b([0-9]{1,2})\s*(personas|personas?|\bpax\b)?\b/);
          const pax = peopleMatch ? `${peopleMatch[1]} personas` : "1 persona";
          const info = hora ? `${nombre} a las ${hora} (${pax})` : `${nombre} (${pax})`;
          reservas.push(`${info} ‚Äî ${fecha}`);
          append('Paco',`‚úÖ Reserva registrada para ${info} el ${fecha}`,log);
        } else {
          append('Paco','Perfecto, ¬øpara qu√© d√≠a y a qu√© hora quieres la reserva? (puedes escribir "hoy", "ma√±ana" o usar el calendario).',log);
          openCalendar('paco');
        }
        return;
      case 'ver_reservas':
        if(reservas.length===0){ append('Paco','No tienes reservas üòÖ',log); return; }
        append('Paco','Tus reservas:\n'+reservas.join('\n'),log); return;
      case 'cancelar_reserva':
        if(reservas.length===0){ append('Paco','No hay reservas que cancelar üòÖ',log); return; }
        if(fecha){
          const idx = reservas.findIndex(r => r.includes(fecha));
          if(idx >= 0){
            const removed = reservas.splice(idx,1)[0];
            append('Paco',`He cancelado la reserva: ${removed}`,log); return;
          }
        }
        const r = reservas.pop(); append('Paco',`He cancelado tu √∫ltima reserva: ${r}`,log); return;
      case 'menu':
        openMenu(); return;
      case 'horario':
        append('Paco','Abrimos de 12:00 a 16:00 y de 19:00 a 23:00. ¬øQuieres reservar ahora?',log); return;
      case 'gracias':
        append('Paco','¬°De nada! üòÑ ¬øAlgo m√°s en lo que te pueda ayudar?',log); return;
      case 'despedida':
        append('Paco','¬°Hasta luego! Te esperamos üçΩÔ∏è',log); return;
      default:
        break;
    }
  }

  if(match.score >= SUGGEST_THRESHOLD){
    if(match.intent === 'reservar'){
      append('Paco',`Parece que quieres *reservar* (interpreto: "${match.sample}"). ¬øAbrimos el calendario para elegir d√≠a/hora?`,log);
      openCalendar('paco'); return;
    }
    if(match.intent === 'menu'){
      openMenu(); return;
    }
    if(match.intent === 'ver_reservas'){
      if(reservas.length===0){ append('Paco','Creo que quieres ver tus reservas, pero no tienes ninguna üòÖ',log); return; }
      append('Paco','Creo que quieres ver tus reservas:\n'+reservas.join('\n'),log); return;
    }
    if(match.intent === 'cancelar_reserva'){
      append('Paco','¬øQuieres que cancele tu √∫ltima reserva? (escribe "s√≠" para confirmar)',log); return;
    }
  }

  // reglas r√°pidas si detecta fecha/hora
  if(/\b\d{1,2}[\/\-]\d{1,2}([\/\-]\d{2,4})?\b/.test(msg) || /\b(hoy|ma√±ana|manana)\b/.test(norm) || /(\b(a las|am|pm|:)\b)/.test(norm)){
    if(fecha){
      const peopleMatch = normalize(msg).match(/\b([0-9]{1,2})\s*(personas|personas?|\bpax\b)?\b/);
      const pax = peopleMatch ? `${peopleMatch[1]} personas` : "1 persona";
      const info = hora ? `${nombre} a las ${hora} (${pax})` : `${nombre} (${pax})`;
      reservas.push(`${info} ‚Äî ${fecha}`);
      append('Paco',`‚úÖ Reserva registrada para ${info} el ${fecha}`,log); return;
    } else {
      append('Paco','Veo una referencia temporal, ¬øpuedes confirmar fecha y hora? (ej: "ma√±ana a las 20 para Juan, 4 personas")',log); return;
    }
  }

  // fallback
  append('Paco','No entend√≠ bien ‚Äî puedes decir, por ejemplo:\n- "Reservar mesa para ma√±ana a las 20 para Juan"\n- "Ver mis reservas"\n- "Cancelar reserva"\n- "Ver men√∫"',log);
}

/* -------------------------
   CALENDARIO Y MENU (sin tocar visual)
   ------------------------- */
function openCalendar(bot){
  const modal = document.getElementById("calendarModal");
  const container = document.getElementById("calendarContainer");
  container.innerHTML = "";
  modal.style.display = "flex";

  const meses = ["Enero","Febrero","Marzo","Abril","Mayo","Junio","Julio","Agosto","Septiembre","Octubre","Noviembre","Diciembre"];
  const hoy = new Date();
  const a√±o = hoy.getFullYear();

  for (let m = 0; m < 12; m++) {
    const monthDiv = document.createElement("div");
    monthDiv.className = "month-container";

    const title = document.createElement("div");
    title.className = "month-title";
    title.textContent = meses[m];
    monthDiv.appendChild(title);

    const daysDiv = document.createElement("div");
    daysDiv.className = "calendar";

    const daysInMonth = new Date(a√±o, m + 1, 0).getDate();

    for (let d = 1; d <= daysInMonth; d++) {
      const dayDiv = document.createElement("div");
      dayDiv.className = "day";
      dayDiv.textContent = d;

      dayDiv.onclick = function() {
        const fecha = `${d}/${m + 1}/${a√±o}`;
        const inputField = (bot === "aura") ? document.getElementById("userInput") : document.getElementById("userInput2");
        const log = (bot === "aura") ? document.getElementById("chatlog") : document.getElementById("chatlog2");
        const msg = inputField.value.trim();

        const nombreMatch = msg.match(/para\s+([A-Z√Å√â√ç√ì√ö√ú√ëa-z√°√©√≠√≥√∫√º√±]+)/i);
        const nombre = nombreMatch ? nombreMatch[1] : "Cliente";

        const horaMatch = msg.match(/(\d{1,2}(:\d{2})?\s*(am|pm)?)/i);
        const hora = horaMatch ? horaMatch[0] : "";

        // detectar n√∫mero de personas si es Paco
        const paxMatch = msg.match(/\b([0-9]{1,2})\s*(personas|personas?|\bpax\b)?\b/i);
        const pax = paxMatch ? `${paxMatch[1]} personas` : "";

        const info = hora ? `${nombre} a las ${hora}` : nombre;
        if (bot === "aura") {
          citas.push(`${info} ‚Äî ${fecha}`);
          append("Aura", `‚úÖ Cita registrada para ${info} el ${fecha}`, log);
        } else {
          const fullInfo = pax ? `${info} (${pax})` : info;
          reservas.push(`${fullInfo} ‚Äî ${fecha}`);
          append("Paco", `‚úÖ Reserva registrada para ${fullInfo} el ${fecha}`, log);
        }

        dayDiv.classList.add("has-event");
        setTimeout(() => { modal.style.display = "none"; }, 800);
      };

      daysDiv.appendChild(dayDiv);
    }

    monthDiv.appendChild(daysDiv);
    container.appendChild(monthDiv);
  }
}

function closeCalendar(){document.getElementById("calendarModal").style.display="none";}
function openMenu(){
  const cont=document.getElementById("menuContainer");cont.innerHTML="";
  menu.forEach(m=>{const div=document.createElement("div");div.className="menu-item";div.innerHTML=`${m.plato} <span>${m.precio} | ${m.alergenos}</span>`;cont.appendChild(div);});
  document.getElementById("menuModal").style.display="flex";
}
function closeMenu(){document.getElementById("menuModal").style.display="none";}
</script>
</body>
</html>
